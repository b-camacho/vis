<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="icon" href="../../favicon.ico">
    <link type="text/css" rel="stylesheet" href="/css/materialize.min.css" media="screen,projection"/>
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="/font-awesome-4.6.3/css/font-awesome.min.css" rel="stylesheet">

    <link rel="stylesheet" href="/css/main.css">


    <title>Visualizer</title>
</head>

<body>

<script src="/js/jquery-3.1.0.min.js"></script>
<script src="/js/d3.v4.min.js"></script>
<script src="/js/remove-diacritics.js"></script>
<script src="/js/d3-scale-chromatic.v1.min.js"></script>
<script src="/js/collaboration-graph.js"></script>
<script src="/js/d3-tip.js"></script>
<script src="/js/parse-raw-expertus.js"></script>
<script src="/js/collab-demo-1.js"></script>
<script src="/js/bar-graph.js"></script>
<script src="/js/works-over-time-demo-1.js"></script>
<script src="/js/expertus-retriever.js"></script>
<script src="/js/materialize.min.js"></script>
<!-- GoStats JavaScript Based Code -->
<script type="text/javascript" src="http://gostats.pl/js/counter.js"></script>
<script type="text/javascript">_gos='monster.gostats.pl';_goa=493654;
_got=5;_goi=1;_gol='licznik na stronie';_GoStatsRun();</script>
<noscript><a target="_blank" title="licznik na stronie"
             href="http://gostats.pl"><img alt="licznik na stronie"
                                           src="http://monster.gostats.pl/bin/count/a_493654/t_5/i_1/counter.png"
                                           style="border-width:0" /></a></noscript>
<!-- End GoStats JavaScript Based Code -->

<div class="row top-nav z-depth-1">
    <div style="float: left; height: 50px">
        <ul>
            <li style="font-size: xx-large; margin-bottom: -8px; margin-top: -10px"><a href="/">Scientific output visualizer</a></li>
        </ul>
    </div>



    <!--<div style="float: right" class="input-field-container" hidden>-->
            <!--<input placeholder="Nazwisko i imię" type="text id="name-and-surname-autocomplete"-->
                   <!--class=" autocomplete name-input-bar" name="name" title="name" style="color: #454545;margin-bottom: 10px"-->
                   <!--oninput="InputChanged()" onfocus="SetInputFocused()"-->
                   <!--onblur="SetInputBlurred()">-->
            <!--<ul id="results" class="dropdown-content" style="opacity:100; display: block"></ul>-->
    <!--</div>-->
    <div style="float: right; margin-right: 20px;">
        <form method="post" action="upload" enctype="multipart/form-data">
            <div class="file-field input-field btn" >
                Upload file
                <input type="file" id="file-input" name="expertus" onchange="StartUpload()">
                <!--<div class="file-path-wrapper">-->
                <!--<input class="file-path validate" type="text">-->
                <!--</div>-->
            </div>

            <input type="submit" hidden="hidden" id="file-input-submit">

        </form>
    </div>

    <div class="top-link"><a href="/pl">Polski</a></div>

    <div class="top-link"><a href="about.html">About</a></div>

    <div class="top-link"><a href="goal.html">Our goal</a></div>

    <div class="top-link"><a href="data.html">Data</a></div>


    <div style="margin-left: auto; margin-right: auto;padding-top: 5px;  width: 300px; height:5em">
        <ul>
            <li style="margin-top: -15px;" id="query-name-caption">Visualisation for:</li>
            <li><div id="query-name-container" class="name-display"></div></li>
        </ul>
    </div>










</div>


<script>
    function StartUpload() {
    $('#file-input-submit').click();
    }
</script>
<script>

    var DetailedDescriptions = {
        graph: 'The visualisation represents all coauthors of the work which occur in the Expertus database.' +
        ' The centre of the network is the author\'s node. The amount of shared works is represented by the distance between the two nodes',
        works: 'The amount of works published each year according to the Expertus database is displayed as a function of time' +
        'This allows for a quantitive analysys of oneself\'s publication activity as a function of time. Monographs are shown in red',
        bubbles: 'The bubble graph illustrates the collective amount of pages in publications from a given year. Unusually large values point to a book or a series of long chapters being published. The lower graph displays a sum of points granted by MNiSW (The Ministry of Science and Higher Education) for all publication from a given year',
        map: 'The map illustrates locations where the author\'s works are published. The displayed area is automatically scaled to fit the geographic range of occuring locations',
        wordcloud: 'Statistical analysis of author-specified keywords, visualised with a wordcloud. The largest words represent the most common occurence, therefore underlining the weight of a certain topic or idea in the scope of the author\'s research. Separate visualisations are generated for Polish and English keywords',
        circle:'A Map of scientific domains presented as a ring plot, used for illustrating the distribution of the author\'s publication across domains. The placement of a publication is based on the journal it was published it. ' +
        'The domain circle is separated into 6 segments colored according to the key provided by K. Boyack in his global UCSD global science map: http://www.mapofscience.com'
    }

    $(document).ready(function () {

        var selectForm = $('#name-select-form');
        selectForm.submit(function (event) {
            event.preventDefault();
            var trueName = $('label[for="' + $('input[type="radio"]:checked').attr("id") + '"]').text();
            $('.vis-form-name-input').val(trueName);
        })
    });
    var inputFocused = false;
    var wasChangedControlValue = 0;

    function SetInputFocused() {
        inputFocused = true;
    }
    function SetInputBlurred() {
        inputFocused = false;
    }

    function InputChanged() {
        wasChangedControlValue++;
        var thisId = wasChangedControlValue;
        setTimeout(function () {
            if (wasChangedControlValue == thisId) {
                QueryForSuggestions()
                wasChangedControlValue = 0;
            }
        }, 1500)
    }

    function DisplayDetails(visName) {
        $('#details-host').text(DetailedDescriptions[visName])
    }

    function QueryForSuggestions() {
        var autocompletedInput = $('#name-and-surname-autocomplete');
        var queryName = autocompletedInput.val();
        console.log(queryName);

        $.ajax('/name-lookup', {
            data: {
                name: queryName
            }
        }).done(function (queryResults) {
            console.log(queryResults);

            function getLi(content) {
                return '<li onclick="SetChosenResult(this)" class="dropdown-namelist-item"><span>' + content + ' </span> </li >'
            }

            var $results = $('#results');
            queryResults.forEach(function (result) {
                $results.append(getLi(result))
            })

        });
//        var queryResults = {};
//        queryResults[queryName] = null;
//        queryResults[queryName + '1'] = null;
//        queryResults[queryName + '2'] = null;
//        $('input.autocomplete').autocomplete({
//            queryResults,
//            limit: 20 // The max amount of results that can be shown at once. Default: Infinity.
//        });
    }

    function SetChosenResult(chosenListElement) {
        console.log('Selected ' + chosenListElement.textContent);

        var resultArray = chosenListElement.textContent.trim().split(' ');
        resultArray = resultArray.map(function (allCapsWord) {
            var initial = allCapsWord.charAt(0);
            return initial + allCapsWord.slice(1).toLocaleLowerCase()
        });
        $('#name-and-surname-autocomplete').val(chosenListElement.textContent);
        $('#results').empty();
        EnableVisualisationRedirectButtons();
        document.cookie = 'name=' + resultArray[resultArray.length - 1] + ' ' + resultArray[0] + '; ';
        console.log(document.cookie)
    }

    $('document').ready(
        $.ajax('name').done(function (response) {
            var $nameContainer = $('#query-name-container')
                ,$nameCaption = $('#query-name-caption');
            if(response.available) {
                $nameContainer.text(response.name);
                $nameContainer.css('display', 'visible');
                $nameCaption.css('display', 'visible');
            }
            else {
                $nameContainer.css('display', 'none');
                $nameCaption.css('display', 'none');
            }
        }))
</script>

<div class="row main-row">
    <div class="col s8" style="margin-top: 20px">
        <div class="row">


            <div class="col s4" id="row1">

                <div class="card white-text" style="margin-bottom: 20px">
                    <a href="works.html" onmouseover="(function display(){DisplayDetails('works')})()">
                        <div class="card-image" >
                            <img src="/images/worksnew.png">
                            <!--<span class="card-title black-text">Dynamika liczby publikacji</span>-->
                        </div>
                    </a>
                </div>


                <div class="card white-text">
                    <a href="research-map.html">
                        <div class="card-image" onmouseover="(function display(){DisplayDetails('circle')})()">
                            <img src="/images/research-map.jpg">
                            <!--<span class="card-title black-text">Publikacje na kole dziedzin</span>-->
                        </div>
                    </a>
                </div>

            </div>


            <div class="col s4" id="row2">

                <div class="card white-text" style="margin-bottom: 20px">
                    <a href="collab.html">
                        <div class="card-image" onmouseover="(function display(){DisplayDetails('graph')})()">
                            <img src="/images/collab.jpg">
                            <!--<span class="card-title black-text">Graf współautorstwa</span>-->
                        </div>
                    </a>
                </div>


                <div class="card white-text">
                    <a href="bubbles.html">
                        <div class="card-image" onmouseover="(function display(){DisplayDetails('bubbles')})()">
                            <img src="/images/bubbles.jpg" >
                            <!--<span class="card-title black-text">Objętość piśmiennicza w skali czasu</span>-->
                        </div>
                    </a>
                </div>

            </div>


            <div class="col s4" id="row3">

                <div class="card white-text" style="margin-bottom: 20px">
                    <a href="google-map.html">
                        <div class="card-image" onmouseover="(function display(){DisplayDetails('map')})()">
                            <img src="/images/google-map.jpg">
                            <!--<span class="card-title black-text">Mapa publikowania prac</span>-->
                        </div>
                    </a>

                </div>


                <div class="card white-text">
                    <a href="wordcloud.html">
                        <div class="card-image" onmouseover="(function display(){DisplayDetails('wordcloud')})()">
                            <img src="/images/wordcloud.jpg">
                            <!--<span class="card-title black-text">Key-word clusters</span>-->
                        </div>
                    </a>

                </div>

            </div>

        </div>
    </div>




    <div class="col s4" style="height: 100%; padding-right: 0">
        <div class="z-depth-1 vis-select ">

            <!--<div class="row" hidden="hidden">-->
                <!--<div class="card file-input-card">-->
                    <!--<div class="card-content black-text file-input-container">-->
                        <!--<span class="card-title"> Dane wejściowe</span>-->
                        <!--<p>prześlij plik z bazy ekspertus, na podstawie ktorego strona wygeneruje wizualizacje</p>-->
                        <!--<form action="#" id="file-input-form">-->
                            <!--<div class="file-field input-field">-->
                                <!--<div class="btn">-->
                                    <!--<span>Plik</span>-->
                                    <!--<input type="file" id="file-input">-->
                                <!--</div>-->
                                <!--<div class="file-path-wrapper">-->
                                    <!--<input class="file-path validate" type="text">-->
                                <!--</div>-->
                            <!--</div>-->
                        <!--</form>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->

            <div class="row" hidden>
                <div class="card name-input-card col s12">
                    <div class="card-content black-text">
                        <span class="card-title">Nazwisko i Imię</span>
                        <p>Podaj swoje nazwisko i imię powyżej, a aplikacja przeszuka bazę Ekspertus i wczyta twoje prace.</p>

                    </div>

                </div>
            </div>
            <div class="row">
                <div class="card name-input-card col s12">
                    <div class="card-content black-text">
                        <span class="card-title">Visualisation description:</span> <br>
                        <span id="details-host"></span>

                    </div>

                </div>
            </div>
        </div>
    </div>
</div>


</body>
</html>
